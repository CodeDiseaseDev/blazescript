name: C/C++ CI

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    strategy:
      matrix:
       os: [ubuntu-latest, windows-latest, macos-latest]
       
    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v3
    
    - name: make
      run: make
      
    - name: Copy release
      run: |
        if [ "$RUNNER_OS" == "Windows" ]; then
          move blaze ..
        else
          sudo cp blaze /tmp/blaze
        fi
      
    - name: Change branch
      run: git pull --all && git switch workflow
      
    - name: Move release
      run: |
        if [ "$RUNNER_OS" == "Windows" ]; then
          move ../blaze $GITHUB_WORKSPACE/blaze-${{ matrix.os }}
        else
          sudo mv /tmp/blaze $GITHUB_WORKSPACE/blaze-${{ matrix.os }}
        fi
  
    - name: Commit
      run: |
        (git config --global user.name 'GitHub Actions' &&
        git config --global user.email 'virtual-designer@users.noreply.github.com' &&
        git add blaze-* &&
        git commit -m "Automated Build Workflow Commit" &&
        git push origin workflow --force) || echo 0
